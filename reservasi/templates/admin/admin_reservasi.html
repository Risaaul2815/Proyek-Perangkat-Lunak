{% extends 'admin/base_admin.html' %}
{% load static %}

{% block content %}

<div class="page-header">
    <h2 class="page-title">ðŸª‘ Daftar Reservasi Meja</h2>
</div>

<table class="table-style">
    <thead>
        <tr>
            <th>Nama Pemesan</th>
            <th>Nomor Meja</th>
            <th>Tanggal</th>
            <th>Waktu</th>
            <th>Dibuat Pada</th>
            <th>Bukti Pembayaran</th>
            <th>Status</th>
            <th class="action-header">Aksi</th>
        </tr>
    </thead>

    <tbody>
        {% for r in reservations %}
        <tr>
            <td>
                {% if r.user %}
                    {{ r.user.username }}
                {% else %}
                    Guest
                {% endif %}
            </td>

            <td>Meja {{ r.meja.nomor }}</td>
            <td>{{ r.tanggal_reservasi }}</td>
            <td>{{ r.jam_reservasi }}</td>
            <td>{{ r.waktu_dibuat|date:"d M Y H:i" }}</td>

            <td>
                {% if r.bukti_pembayaran %}
                    <a href="{{ r.bukti_pembayaran.url }}" target="_blank" class="btn-small-view">
                        Lihat Bukti
                    </a>
                {% else %}
                    -
                {% endif %}
            </td>

            <td>
                <span class="status {{ r.status }}">
                    {{ r.get_status_display }}
                </span>
            </td>

            <td class="action-col">
                {% if r.status == 'pending' %}
                    <a href="{% url 'update_reservasi_status' r.id %}?status=confirmed"
                       class="btn-small green">
                        Konfirmasi
                    </a>
                {% endif %}

                {% if r.status != 'completed' %}
                    <a href="{% url 'update_reservasi_status' r.id %}?status=completed"
                       class="btn-small blue">
                        Selesai
                    </a>
                {% endif %}

                {% if r.status != 'cancelled' %}
                    <a href="{% url 'update_reservasi_status' r.id %}?status=cancelled"
                       class="btn-small red">
                        Batalkan
                    </a>
                {% endif %}
            </td>
        </tr>

        {% empty %}
        <tr>
            <td colspan="8" class="empty-row">Belum ada reservasi.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<style>

.status.pending { color: #e67e22; font-weight: bold; }
.status.confirmed { color: #3498db; font-weight: bold; }
.status.completed { color: #2ecc71; font-weight: bold; }
.status.cancelled { color: #e74c3c; font-weight: bold; }

.btn-small {
    padding: 6px 10px;
    border-radius: 6px;
    text-decoration: none;
    color: white;
    font-size: 13px;
    text-align: center;
}

.btn-small.green { background-color: #2ecc71; }
.btn-small.blue { background-color: #3498db; }
.btn-small.red { background-color: #e74c3c; }

.action-col {
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: center;
}

.action-header {
    text-align: center;
    vertical-align: middle;
    width: 140px;        
}

.table-style th,
.table-style td {
    vertical-align: middle;
}
</style>

{% endblock %}